#!/usr/bin/env node
import { readFileSync, writeFileSync } from 'fs'
import path from 'path'

const root = process.cwd()
const sourcePath = path.join(root, 'docs', 'fallback-texts.md')
const targetPath = path.join(root, 'lib', 'fallback-texts.generated.ts')

const raw = readFileSync(sourcePath, 'utf8')
const match = raw.match(/```json\s*([\s\S]*?)```/)
if (!match) {
  throw new Error('Could not find fallback copy JSON block in docs/fallback-texts.md')
}

const jsonText = match[1].trim()
const data = JSON.parse(jsonText)
const banner = `// This file is auto-generated by scripts/extract-fallback-copy.mjs.\n// Do not edit it manuallyâ€”update docs/fallback-texts.md instead and run \`pnpm fallback:sync\`.\n`
const content = `${banner}export const FALLBACK_TEXTS = ${JSON.stringify(data, null, 2)} as const;\n\nexport type FallbackTexts = typeof FALLBACK_TEXTS;\n`

writeFileSync(targetPath, content)
console.log(`Fallback copy extracted to ${path.relative(root, targetPath)}`)
